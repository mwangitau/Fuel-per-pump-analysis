<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Shell Mangu Fuel Pump Analysis</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <style>
    body {font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin:0; padding:20px; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); min-height:100vh;}
    .container {max-width:1200px;margin:0 auto;background:rgba(255,255,255,0.95);border-radius:20px;padding:30px;box-shadow:0 20px 40px rgba(0,0,0,0.1);}
    h1 {text-align:center;color:#2c3e50;margin-bottom:30px;font-size:2.5em;background:linear-gradient(45deg,#3498db,#9b59b6);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
    .metrics-grid {display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:30px;}
    .metric-card {background:linear-gradient(135deg,#667eea,#764ba2);color:white;padding:20px;border-radius:15px;text-align:center;box-shadow:0 10px 25px rgba(0,0,0,0.1);transition:transform 0.3s ease;}
    .metric-card:hover {transform:translateY(-5px);}
    .metric-value {font-size:2em;font-weight:bold;margin-bottom:5px;}
    .metric-label {font-size:0.9em;opacity:0.9;}
    .chart-container {background:white;border-radius:15px;padding:20px;margin-bottom:20px;box-shadow:0 5px 15px rgba(0,0,0,0.1);}
    .analysis-section {background:#f8f9fa;border-radius:15px;padding:25px;margin-bottom:20px;border-left:5px solid #3498db;}
    .analysis-section h3 {color:#2c3e50;margin-bottom:15px;font-size:1.3em;}
    .insights-list {list-style:none;padding:0;}
    .insights-list li {background:white;margin:10px 0;padding:15px;border-radius:8px;border-left:4px solid #e74c3c;box-shadow:0 2px 5px rgba(0,0,0,0.05);}
    .filter-section {display:flex;gap:15px;margin-bottom:20px;flex-wrap:wrap;}
    select,button {padding:10px 15px;border:none;border-radius:8px;background:linear-gradient(135deg,#667eea,#764ba2);color:white;cursor:pointer;font-size:14px;}
    select:hover,button:hover {opacity:0.9;}
    .data-table {width:100%;border-collapse:collapse;background:white;border-radius:10px;overflow:hidden;box-shadow:0 5px 15px rgba(0,0,0,0.1);}
    .data-table th,.data-table td {padding:12px;text-align:left;border-bottom:1px solid #eee;}
    .data-table th {background:linear-gradient(135deg,#667eea,#764ba2);color:white;font-weight:bold;}
    footer {margin-top:30px;font-size:13px;color:#777;line-height:1.5;text-align:center;}
  </style>
</head>
<body>
  <div class="container">
    <h1>â›½ Shell Mangu Fuel Pump Analysis - Volume Sales (Litres)</h1>
    
    <div class="metrics-grid" id="metricsGrid"></div>
    
    <div class="filter-section">
      <select id="attendantFilter"><option value="all">All Attendants</option></select>
      <select id="pumpFilter">
        <option value="all">All Pumps</option>
        <option value="PUMP 1">Pump 1</option>
        <option value="PUMP 2">Pump 2</option>
        <option value="PUMP3">Pump 3</option>
      </select>
      <button onclick="updateAnalysis()">Update Analysis</button>
    </div>
    
    <div class="chart-container"><canvas id="dailySalesChart"></canvas></div>
    <div class="chart-container"><canvas id="attendantPerformanceChart"></canvas></div>
    <div class="chart-container"><canvas id="pumpComparisonChart"></canvas></div>
    
    <div class="analysis-section">
      <h3>ðŸ“Š Key Insights</h3>
      <ul class="insights-list" id="insightsList"></ul>
    </div>
    
    <div class="analysis-section">
      <h3>ðŸ“‹ Detailed Data</h3>
      <div style="overflow-x:auto;">
        <table class="data-table" id="dataTable"></table>
      </div>
    </div>
    
    <footer>
      <p>Â© 2025 Kiryan Energy Ltd â€” All Rights Reserved.</p>
      <p><strong>Confidential:</strong> These dashboards are for official use only and must not be copied, shared, or distributed without prior written permission from Kiryan Energy Ltd.</p>
    </footer>
  </div>

  <script>
    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTO3PNP1zG_QTHC6pY0lVTrchtBF36Tc1FKIuyGfBdexGVJNVj34reyTws-5vmGP8cst3YndAdNmB_P/pub?gid=1471167944&single=true&output=csv";

    let processedData = [], attendantsSet = new Set();

    function csvToRows(csv, delimiter=',') {
      return csv.trim().split('\n').map(line => line.split(delimiter).map(c => c.trim()));
    }
    function formatDate(str) {
      const parts = str.split(".");
      if (parts.length<3) return str;
      return `${parts[0]}-${parts[1].padStart(2,"0")}-${parts[2].padStart(2,"0")}`;
    }

    async function loadFuelData() {
      const resp = await fetch(csvUrl);
      const text = await resp.text();
      const rows = csvToRows(text);
      rows.shift(); // header

      processedData = [];
      attendantsSet = new Set();

      rows.forEach(r=>{
        const date = formatDate(r[0]);
        const pump1={attendant:r[1], value:Math.abs(parseFloat(r[2])||0)};
        const pump2={attendant:r[3], value:Math.abs(parseFloat(r[4])||0)};
        const pump3={attendant:r[5], value:Math.abs(parseFloat(r[6])||0)};
        const total = pump1.value+pump2.value+pump3.value;

        processedData.push({date,pump1,pump2,pump3,total});
        [pump1,pump2,pump3].forEach(p=>attendantsSet.add(p.attendant));
      });

      populateFilters();
      updateAnalysis();
    }

    function populateFilters() {
      const af=document.getElementById('attendantFilter');
      af.innerHTML='<option value="all">All Attendants</option>';
      Array.from(attendantsSet).sort().forEach(att=>{
        const opt=document.createElement('option');
        opt.value=att; opt.textContent=att; af.appendChild(opt);
      });
    }

    // Filtering logic
    function getFilteredData() {
      const att=document.getElementById('attendantFilter').value;
      const pump=document.getElementById('pumpFilter').value;
      return processedData.map(r=>{
        let pumps={};
        ["pump1","pump2","pump3"].forEach((key,i)=>{
          const pName=i===0?"PUMP 1":i===1?"PUMP 2":"PUMP3";
          pumps[key]=r[key];
          if ((att!=="all" && r[key].attendant!==att) || (pump!=="all" && pName!==pump)) {
            pumps[key]={attendant:r[key].attendant,value:0};
          }
        });
        return {date:r.date,...pumps,total:pumps.pump1.value+pumps.pump2.value+pumps.pump3.value};
      });
    }

    function updateMetrics(filtered) {
      const dailyTotals={}, attendantTotals={}, pumpTotals={"PUMP 1":0,"PUMP 2":0,"PUMP3":0};
      filtered.forEach(r=>{
        dailyTotals[r.date]=(dailyTotals[r.date]||0)+r.total;
        [["PUMP 1",r.pump1],["PUMP 2",r.pump2],["PUMP3",r.pump3]].forEach(([name,p])=>{
          if (!attendantTotals[p.attendant]) attendantTotals[p.attendant]=0;
          attendantTotals[p.attendant]+=p.value;
          pumpTotals[name]+=p.value;
        });
      });
      const total=Object.values(dailyTotals).reduce((a,b)=>a+b,0);
      const avg=total/Object.keys(dailyTotals).length||0;
      const bestDay=Object.keys(dailyTotals).reduce((a,b)=>dailyTotals[a]>dailyTotals[b]?a:b,"-");
      const topAtt=Object.keys(attendantTotals).reduce((a,b)=>attendantTotals[a]>attendantTotals[b]?a:b,"-");
      const topPump=Object.keys(pumpTotals).reduce((a,b)=>pumpTotals[a]>pumpTotals[b]?a:b,"-");
      document.getElementById('metricsGrid').innerHTML=`
        <div class="metric-card"><div class="metric-value">${total.toLocaleString()} L</div><div class="metric-label">Total Volume Sold</div></div>
        <div class="metric-card"><div class="metric-value">${Math.round(avg).toLocaleString()} L</div><div class="metric-label">Average Daily Volume</div></div>
        <div class="metric-card"><div class="metric-value">${bestDay}</div><div class="metric-label">Best Sales Day</div></div>
        <div class="metric-card"><div class="metric-value">${topAtt}</div><div class="metric-label">Top Performer</div></div>
        <div class="metric-card"><div class="metric-value">${topPump}</div><div class="metric-label">Best Pump</div></div>`;
      return {dailyTotals,attendantTotals,pumpTotals};
    }

    function createCharts(dailyTotals,attendantTotals,pumpTotals) {
      new Chart(document.getElementById('dailySalesChart').getContext('2d'),{
        type:'line',
        data:{labels:Object.keys(dailyTotals),datasets:[{label:'Daily Volume (L)',data:Object.values(dailyTotals),borderColor:'#667eea',backgroundColor:'rgba(102,126,234,0.1)',tension:0.4,fill:true}]},
        options:{responsive:true,plugins:{title:{display:true,text:'Daily Fuel Volume Sales Trend'}},scales:{y:{beginAtZero:true,ticks:{callback:v=>v.toLocaleString()+" L"}}}}
      });
      new Chart(document.getElementById('attendantPerformanceChart').getContext('2d'),{
        type:'bar',
        data:{labels:Object.keys(attendantTotals),datasets:[{label:'Total Volume (L)',data:Object.values(attendantTotals),backgroundColor:'#667eea'}]},
        options:{responsive:true,plugins:{title:{display:true,text:'Attendant Performance'}}}
      });
      new Chart(document.getElementById('pumpComparisonChart').getContext('2d'),{
        type:'doughnut',
        data:{labels:Object.keys(pumpTotals),datasets:[{data:Object.values(pumpTotals),backgroundColor:['#667eea','#764ba2','#f093fb']}]},
        options:{responsive:true,plugins:{title:{display:true,text:'Volume Sales by Pump'}}}
      });
    }

    function updateInsights(dailyTotals,attendantTotals,pumpTotals) {
      const total=Object.values(dailyTotals).reduce((a,b)=>a+b,0);
      const avg=total/Object.keys(dailyTotals).length||0;
      const topAtt=Object.keys(attendantTotals).reduce((a,b)=>attendantTotals[a]>attendantTotals[b]?a:b,"-");
      const topPump=Object.keys(pumpTotals).reduce((a,b)=>pumpTotals[a]>pumpTotals[b]?a:b,"-");
      const bestDay=Object.keys(dailyTotals).reduce((a,b)=>dailyTotals[a]>dailyTotals[b]?a:b,"-");
      document.getElementById('insightsList').innerHTML=[
        `Total fuel volume sold: ${total.toLocaleString()} L`,
        `Best performing attendant: ${topAtt}`,
        `Most productive pump: ${topPump}`,
        `Average daily volume: ${Math.round(avg).toLocaleString()} L`,
        `Peak volume day: ${bestDay}`
      ].map(i=>`<li>${i}</li>`).join('');
    }

    function updateDataTable(filtered) {
      let html=`<thead><tr><th>Date</th><th>Pump 1 Attendant</th><th>Pump 1 Volume</th><th>Pump 2 Attendant</th><th>Pump 2 Volume</th><th>Pump 3 Attendant</th><th>Pump 3 Volume</th><th>Daily Total</th></tr></thead><tbody>`;
      filtered.forEach(r=>{
        html+=`<tr><td>${r.date}</td><td>${r.pump1.attendant}</td><td>${r.pump1.value.toLocaleString()} L</td><td>${r.pump2.attendant}</td><td>${r.pump2.value.toLocaleString()} L</td><td>${r.pump3.attendant}</td><td>${r.pump3.value.toLocaleString()} L</td><td><strong>${r.total.toLocaleString()} L</strong></td></tr>`;
      });
      html+='</tbody>';
      document.getElementById('dataTable').innerHTML=html;
    }

    function updateAnalysis() {
      const filtered=getFilteredData();
      const {dailyTotals,attendantTotals,pumpTotals}=updateMetrics(filtered);
      createCharts(dailyTotals,attendantTotals,pumpTotals);
      updateInsights(dailyTotals,attendantTotals,pumpTotals);
      updateDataTable(filtered);
    }

    document.addEventListener('DOMContentLoaded', loadFuelData);
  </script>
</body>
</html>



