<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Product Analysis Dashboard - Kiryan Energy Ltd</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      min-height: 100vh;
      color: white;
      overflow-x: auto;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 30px;
      backdrop-filter: blur(20px);
      background: rgba(255, 255, 255, 0.05);
      border-radius: 20px;
      margin-top: 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
      animation: fadeInDown 1s ease-out;
    }

    .header h1 {
      font-size: 36px;
      margin-bottom: 10px;
      background: linear-gradient(45deg, #ff6b6b, #ffd93d, #6bcf7f);
      background-size: 400% 400%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: gradientShift 3s ease-in-out infinite;
    }

    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    @keyframes fadeInDown {
      from { transform: translateY(-30px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .loading {
      text-align: center;
      padding: 40px;
      font-size: 18px;
    }

    .error {
      background: rgba(255, 0, 0, 0.2);
      border: 1px solid rgba(255, 0, 0, 0.5);
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
    }

    .summary-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    .summary-card {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 25px;
      border-radius: 15px;
      text-align: center;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      animation: fadeInUp 0.8s ease-out;
    }

    .summary-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    }

    .summary-card h3 {
      font-size: 18px;
      margin-bottom: 15px;
      opacity: 0.9;
    }

    .summary-value {
      font-size: 32px;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .summary-subtitle {
      font-size: 14px;
      opacity: 0.7;
    }

    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 30px;
      margin-bottom: 40px;
    }

    .product-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 20px;
      padding: 30px;
      transition: all 0.3s ease;
      animation: fadeInUp 1s ease-out;
    }

    .product-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
    }

    .product-header {
      display: flex;
      align-items: center;
      margin-bottom: 25px;
    }

    .product-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      margin-right: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      font-weight: bold;
    }

    .dx-card .product-icon { background: linear-gradient(45deg, #2d2d2d, #4a4a4a); }
    .ux-card .product-icon { background: linear-gradient(45deg, #22c55e, #16a34a); }
    .vp-card .product-icon { background: linear-gradient(45deg, #ef4444, #dc2626); }

    .product-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 20px;
    }

    .stat-item {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 10px;
      text-align: center;
    }

    .stat-value {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 12px;
      opacity: 0.7;
    }

    .trend-indicator {
      display: inline-block;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
      margin-top: 10px;
    }

    .trend-positive {
      background: rgba(34, 197, 94, 0.3);
      color: #22c55e;
    }

    .trend-negative {
      background: rgba(239, 68, 68, 0.3);
      color: #ef4444;
    }

    .chart-container {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 30px;
      animation: fadeInUp 1.2s ease-out;
    }

    .chart-title {
      font-size: 24px;
      margin-bottom: 20px;
      text-align: center;
    }

    .chart {
      width: 100%;
      height: 400px;
      margin-bottom: 20px;
    }

    .data-table {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 20px;
      padding: 30px;
      margin-top: 30px;
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    th {
      background: rgba(255, 255, 255, 0.1);
      font-weight: bold;
    }

    tr:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .refresh-btn {
      background: linear-gradient(45deg, #667eea, #764ba2);
      border: none;
      color: white;
      padding: 15px 30px;
      border-radius: 25px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 20px auto;
      display: block;
    }

    .refresh-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
    }

    @keyframes fadeInUp {
      from { transform: translateY(30px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .mini-chart {
      width: 100%;
      height: 100px;
      margin-top: 15px;
    }

    @media (max-width: 768px) {
      .container { padding: 15px; }
      .product-grid { grid-template-columns: 1fr; }
      .summary-cards { grid-template-columns: 1fr; }
      .product-stats { grid-template-columns: 1fr; }
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üè¢ Product Sales Analysis Dashboard</h1>
      <h2>Kiryan Energy Ltd - Mangu Shell Service Station</h2>
      <p>Real-time analysis of DX (Diesel), UX (Unleaded), and V-Power sales performance</p>
    </div>

    <button class="refresh-btn" onclick="loadData()">üîÑ Refresh Data</button>

    <div id="loading" class="loading">
      <h3>üìä Loading sales data...</h3>
      <p>Fetching latest product performance metrics</p>
    </div>

    <div id="error" class="error" style="display: none;">
      <h3>‚ùå Error Loading Data</h3>
      <p id="errorMessage"></p>
    </div>

    <div id="dashboard" style="display: none;">
      <!-- Summary Cards -->
      <div class="summary-cards">
        <div class="summary-card">
          <h3>üìÖ Analysis Period</h3>
          <div class="summary-value" id="analysisPeriod">-</div>
          <div class="summary-subtitle">Days of data</div>
        </div>
        <div class="summary-card">
          <h3>üí∞ Total Revenue</h3>
          <div class="summary-value" id="totalRevenue">-</div>
          <div class="summary-subtitle">All products combined</div>
        </div>
        <div class="summary-card">
          <h3>‚õΩ Average Daily Sales</h3>
          <div class="summary-value" id="avgDailySales">-</div>
          <div class="summary-subtitle">Litres per day</div>
        </div>
        <div class="summary-card">
          <h3>üìà Best Performing Day</h3>
          <div class="summary-value" id="bestDay">-</div>
          <div class="summary-subtitle">Highest sales volume</div>
        </div>
      </div>

      <!-- Product Cards -->
      <div class="product-grid">
        <div class="product-card dx-card">
          <div class="product-header">
            <div class="product-icon">DX</div>
            <div>
              <h3>Diesel (Black)</h3>
              <p>Premium diesel fuel</p>
            </div>
          </div>
          <div class="product-stats">
            <div class="stat-item">
              <div class="stat-value" id="dxTotal">-</div>
              <div class="stat-label">Total Sold (L)</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="dxAvg">-</div>
              <div class="stat-label">Daily Average (L)</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="dxShare">-</div>
              <div class="stat-label">Market Share</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="dxLossGain">-</div>
              <div class="stat-label">Loss/Gain (L)</div>
            </div>
          </div>
          <div class="trend-indicator" id="dxTrend">-</div>
          <canvas class="mini-chart" id="dxChart"></canvas>
        </div>

        <div class="product-card ux-card">
          <div class="product-header">
            <div class="product-icon">UX</div>
            <div>
              <h3>Unleaded (Green)</h3>
              <p>Premium unleaded petrol</p>
            </div>
          </div>
          <div class="product-stats">
            <div class="stat-item">
              <div class="stat-value" id="uxTotal">-</div>
              <div class="stat-label">Total Sold (L)</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="uxAvg">-</div>
              <div class="stat-label">Daily Average (L)</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="uxShare">-</div>
              <div class="stat-label">Market Share</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="uxLossGain">-</div>
              <div class="stat-label">Loss/Gain (L)</div>
            </div>
          </div>
          <div class="trend-indicator" id="uxTrend">-</div>
          <canvas class="mini-chart" id="uxChart"></canvas>
        </div>

        <div class="product-card vp-card">
          <div class="product-header">
            <div class="product-icon">VP</div>
            <div>
              <h3>V-Power (Red)</h3>
              <p>Shell V-Power premium fuel</p>
            </div>
          </div>
          <div class="product-stats">
            <div class="stat-item">
              <div class="stat-value" id="vpTotal">-</div>
              <div class="stat-label">Total Sold (L)</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="vpAvg">-</div>
              <div class="stat-label">Daily Average (L)</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="vpShare">-</div>
              <div class="stat-label">Market Share</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="vpLossGain">-</div>
              <div class="stat-label">Loss/Gain (L)</div>
            </div>
          </div>
          <div class="trend-indicator" id="vpTrend">-</div>
          <canvas class="mini-chart" id="vpChart"></canvas>
        </div>
      </div>

      <!-- Main Sales Chart -->
      <div class="chart-container">
        <h3 class="chart-title">üìä Daily Sales Performance Comparison</h3>
        <canvas class="chart" id="mainChart"></canvas>
      </div>

      <!-- Loss/Gain Chart -->
      <div class="chart-container">
        <h3 class="chart-title">üìà Daily Loss/Gain Analysis</h3>
        <canvas class="chart" id="lossGainChart"></canvas>
      </div>

      <!-- Data Table -->
      <div class="data-table">
        <h3>üìã Detailed Sales Data</h3>
        <div style="overflow-x: auto;">
          <table id="dataTable">
            <thead>
              <tr>
                <th>Date</th>
                <th>UX Sales (L)</th>
                <th>DX Sales (L)</th>
                <th>V-Power Sales (L)</th>
                <th>Total Sales (L)</th>
                <th>UX Loss/Gain</th>
                <th>DX Loss/Gain</th>
                <th>VP Loss/Gain</th>
                <th>Total Loss/Gain</th>
              </tr>
            </thead>
            <tbody id="tableBody">
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script>
    let salesData = [];
    let mainChart, lossGainChart;
    const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTO3PNP1zG_QTHC6pY0lVTrchtBF36Tc1FKIuyGfBdexGVJNVj34reyTws-5vmGP8cst3YndAdNmB_P/pub?gid=1536720731&single=true&output=csv';

    async function loadData() {
      try {
        document.getElementById('loading').style.display = 'block';
        document.getElementById('error').style.display = 'none';
        document.getElementById('dashboard').style.display = 'none';

        const response = await fetch(csvUrl);
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const csvText = await response.text();
        const rows = csvText.split('\n').filter(row => row.trim());
        
        // Skip header row and parse data
        salesData = [];
        for (let i = 1; i < rows.length; i++) {
          const row = rows[i];
          if (row.trim()) {
            const columns = parseCSVRow(row);
            if (columns.length >= 9) {
              const data = {
                date: columns[0],
                ux: parseFloat(columns[1]?.replace(/,/g, '') || 0),
                dx: parseFloat(columns[2]?.replace(/,/g, '') || 0),
                vpower: parseFloat(columns[3]?.replace(/,/g, '') || 0),
                total: parseFloat(columns[4]?.replace(/,/g, '') || 0),
                uxLossGain: parseFloat(columns[5]?.replace(/,/g, '') || 0),
                dxLossGain: parseFloat(columns[6]?.replace(/,/g, '') || 0),
                vpLossGain: parseFloat(columns[7]?.replace(/,/g, '') || 0),
                totalLossGain: parseFloat(columns[8]?.replace(/,/g, '') || 0)
              };
              
              // Only add rows with valid data
              if (data.date && !isNaN(data.total) && data.total > 0) {
                salesData.push(data);
              }
            }
          }
        }

        if (salesData.length === 0) {
          throw new Error('No valid sales data found in the spreadsheet');
        }

        updateDashboard();
        document.getElementById('loading').style.display = 'none';
        document.getElementById('dashboard').style.display = 'block';

      } catch (error) {
        console.error('Error loading data:', error);
        document.getElementById('loading').style.display = 'none';
        document.getElementById('error').style.display = 'block';
        document.getElementById('errorMessage').textContent = `Failed to load data: ${error.message}`;
      }
    }

    function parseCSVRow(row) {
      const result = [];
      let current = '';
      let inQuotes = false;
      
      for (let i = 0; i < row.length; i++) {
        const char = row[i];
        if (char === '"') {
          inQuotes = !inQuotes;
        } else if (char === ',' && !inQuotes) {
          result.push(current.trim());
          current = '';
        } else {
          current += char;
        }
      }
      result.push(current.trim());
      return result;
    }

    function updateDashboard() {
      // Calculate summary statistics
      const totalUX = salesData.reduce((sum, day) => sum + day.ux, 0);
      const totalDX = salesData.reduce((sum, day) => sum + day.dx, 0);
      const totalVP = salesData.reduce((sum, day) => sum + day.vpower, 0);
      const grandTotal = totalUX + totalDX + totalVP;
      const avgDailySales = grandTotal / salesData.length;
      
      const totalUXLoss = salesData.reduce((sum, day) => sum + day.uxLossGain, 0);
      const totalDXLoss = salesData.reduce((sum, day) => sum + day.dxLossGain, 0);
      const totalVPLoss = salesData.reduce((sum, day) => sum + day.vpLossGain, 0);

      // Find best performing day
      const bestDayData = salesData.reduce((max, day) => day.total > max.total ? day : max, salesData[0]);
      
      // Update summary cards
      document.getElementById('analysisPeriod').textContent = salesData.length;
      document.getElementById('totalRevenue').textContent = grandTotal.toLocaleString() + 'L';
      document.getElementById('avgDailySales').textContent = avgDailySales.toFixed(0) + 'L';
      document.getElementById('bestDay').textContent = bestDayData.date;

      // Update product cards
      updateProductCard('dx', totalDX, totalDX / salesData.length, (totalDX / grandTotal * 100), totalDXLoss);
      updateProductCard('ux', totalUX, totalUX / salesData.length, (totalUX / grandTotal * 100), totalUXLoss);
      updateProductCard('vp', totalVP, totalVP / salesData.length, (totalVP / grandTotal * 100), totalVPLoss);

      // Create charts
      createMainChart();
      createLossGainChart();
      createMiniCharts();
      
      // Update table
      updateTable();
    }

    function updateProductCard(product, total, avg, share, lossGain) {
      const prefix = product.toLowerCase();
      document.getElementById(prefix + 'Total').textContent = total.toLocaleString() + 'L';
      document.getElementById(prefix + 'Avg').textContent = avg.toFixed(0) + 'L';
      document.getElementById(prefix + 'Share').textContent = share.toFixed(1) + '%';
      document.getElementById(prefix + 'LossGain').textContent = (lossGain >= 0 ? '+' : '') + lossGain.toFixed(1) + 'L';
      
      const trendElement = document.getElementById(prefix + 'Trend');
      if (lossGain >= 0) {
        trendElement.textContent = 'üìà Gaining';
        trendElement.className = 'trend-indicator trend-positive';
      } else {
        trendElement.textContent = 'üìâ Loss';
        trendElement.className = 'trend-indicator trend-negative';
      }
    }

    function createMainChart() {
      const ctx = document.getElementById('mainChart').getContext('2d');
      
      if (mainChart) {
        mainChart.destroy();
      }
      
      mainChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: salesData.map(d => d.date),
          datasets: [
            {
              label: 'UX (Unleaded)',
              data: salesData.map(d => d.ux),
              borderColor: '#22c55e',
              backgroundColor: 'rgba(34, 197, 94, 0.1)',
              tension: 0.4,
              fill: true
            },
            {
              label: 'DX (Diesel)',
              data: salesData.map(d => d.dx),
              borderColor: '#4a4a4a',
              backgroundColor: 'rgba(74, 74, 74, 0.1)',
              tension: 0.4,
              fill: true
            },
            {
              label: 'V-Power',
              data: salesData.map(d => d.vpower),
              borderColor: '#ef4444',
              backgroundColor: 'rgba(239, 68, 68, 0.1)',
              tension: 0.4,
              fill: true
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              labels: { color: 'white' }
            }
          },
          scales: {
            x: {
              ticks: { color: 'white' },
              grid: { color: 'rgba(255, 255, 255, 0.1)' }
            },
            y: {
              ticks: { color: 'white' },
              grid: { color: 'rgba(255, 255, 255, 0.1)' }
            }
          }
        }
      });
    }

    function createLossGainChart() {
      const ctx = document.getElementById('lossGainChart').getContext('2d');
      
      if (lossGainChart) {
        lossGainChart.destroy();
      }
      
      lossGainChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: salesData.map(d => d.date),
          datasets: [
            {
              label: 'UX Loss/Gain',
              data: salesData.map(d => d.uxLossGain),
              backgroundColor: 'rgba(34, 197, 94, 0.7)',
              borderColor: '#22c55e'
            },
            {
              label: 'DX Loss/Gain',
              data: salesData.map(d => d.dxLossGain),
              backgroundColor: 'rgba(74, 74, 74, 0.7)',
              borderColor: '#4a4a4a'
            },
            {
              label: 'VP Loss/Gain',
              data: salesData.map(d => d.vpLossGain),
              backgroundColor: 'rgba(239, 68, 68, 0.7)',
              borderColor: '#ef4444'
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              labels: { color: 'white' }
            }
          },
          scales: {
            x: {
              ticks: { color: 'white' },
              grid: { color: 'rgba(255, 255, 255, 0.1)' }
            },
            y: {
              ticks: { color: 'white' },
              grid: { color: 'rgba(255, 255, 255, 0.1)' }
            }
          }
        }
      });
    }

    function createMiniCharts() {
      // Create mini charts for each product
      createMiniChart('dxChart', salesData.map(d => d.dx), '#4a4a4a');
      createMiniChart('uxChart', salesData.map(d => d.ux), '#22c55e');
      createMiniChart('vpChart', salesData.map(d => d.vpower), '#ef4444');
    }

    function createMiniChart(canvasId, data, color) {
      const ctx = document.getElementById(canvasId).getContext('2d');
      
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: salesData.map(d => d.date),
          datasets: [{
            data: data,
            borderColor: color,
            backgroundColor: color + '20',
            tension: 0.4,
            fill: true,
            pointRadius: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false }
          },
          scales: {
            x: { display: false },
            y: { display: false }
          },
          elements: {
            point: { radius: 0 }
          }
        }
      });
    }

    function updateTable() {
      const tableBody = document.getElementById('tableBody');
      tableBody.innerHTML = '';
      
      salesData.forEach(day => {
        const row = tableBody.insertRow();
        row.insertCell(0).textContent = day.date;
        row.insertCell(1).textContent = day.ux.toLocaleString() + 'L';
        row.insertCell(2).textContent = day.dx.toLocaleString() + 'L';
        row.insertCell(3).textContent = day.vpower.toLocaleString() + 'L';
        row.insertCell(4).textContent = day.total.toLocaleString() + 'L';
        row.insertCell(5).textContent = (day.uxLossGain >= 0 ? '+' : '') + day.uxLossGain.toFixed(1) + 'L';
        row.insertCell(6).textContent = (day.dxLossGain >= 0 ? '+' : '') + day.dxLossGain.toFixed(1) + 'L';
        row.insertCell(7).textContent = (day.vpLossGain >= 0 ? '+' : '') + day.vpLossGain.toFixed(1) + 'L';
        row.insertCell(8).textContent = (day.totalLossGain >= 0 ? '+' : '') + day.totalLossGain.toFixed(1) + 'L';
      });
    }

    // Load data when page loads
    document.addEventListener('DOMContentLoaded', loadData);
  </script>
</body>
</html>
